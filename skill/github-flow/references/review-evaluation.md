# AI Review 評估決策框架

處理 Gemini Code Assist review 評論的決策指南。
適用於每個未解決的 review thread。

---

## 核心原則

Gemini Code Assist 是靜態分析工具，無法理解專案的整體架構、業務邏輯與歷史決策。
所有建議僅作為參考，不是必須遵從的指令。
當建議與專案既有模式或架構決策衝突時，優先保持專案一致性。

---

## 決策流程

對每個未解決的 review thread，按照以下順序評估：

### 第一步：判斷建議是否基於完整上下文

閱讀評論內容，判斷 Gemini 是否理解該程式碼的完整上下文：

- 是否考慮到專案的既有模式？
- 是否理解該函式/模組的設計意圖？
- 是否考慮到相關的其他檔案？

若建議明顯基於不完整的理解，歸類為「不適用」。

### 第二步：評估建議的合理性與工作量

| 類別 | 判斷條件 | 處理方式 |
|------|---------|---------|
| **合理且簡單** | 明確的 bug、typo、語法錯誤；缺少的錯誤處理；命名改善且確實更好；修復工作量小（幾行程式碼） | 直接修復 |
| **合理但工作量大** | 需要重構的架構改善；跨模組的變更；需要額外調查的效能建議 | 追蹤 |
| **不適用** | 與專案既有模式矛盾；基於不完整上下文的判斷；純粹的風格偏好差異 | 不採納 |

---

## 各類別的具體操作

### 直接修復

1. 修改程式碼
2. 確認修改不破壞既有功能
3. `git add` → `git commit -m "<type>: address review feedback"` → `git push`
4. 解決該 thread（`resolveReviewThread`）

### 追蹤（不在本次 PR 修復）

兩種追蹤方式，根據情況選擇：

**方式 A：TODO 註解**（適用於特定程式碼位置的改善建議）

```python
# TODO: 重構此函式以減少巢狀層級（參考 PR #123 review）
```

**方式 B：GitHub Issue**（適用於跨模組或較大範圍的建議）

```bash
gh issue create --title "重構：<建議摘要>" --body "<詳細說明，引用原始 review 評論>"
```

追蹤後，回覆 review thread 說明處理方式：

```bash
gh pr comment --body "已記錄為 TODO / Issue #N，計劃在後續迭代處理。"
```

然後解決該 thread。

### 不採納

回覆 review thread 簡要說明原因：

```bash
gh pr comment --body "此處的設計是為了與專案既有的 X 模式保持一致。"
```

然後解決該 thread。不需要修改程式碼。

---

## 常見的 Gemini 誤判模式

以下是 Gemini Code Assist 常見的不準確建議，遇到時可直接歸類為「不適用」：

| 誤判模式 | 範例 | 原因 |
|---------|------|------|
| 要求新增已由框架處理的錯誤處理 | 「應加入 null check」但框架已保證非 null | 不理解框架行為 |
| 建議使用它認為「更好」的 API | 「建議使用 X 替代 Y」但專案統一使用 Y | 不理解專案慣例 |
| 要求新增不必要的型別標註 | 「建議明確標註回傳型別」但型別推導已足夠 | 過度嚴格的風格偏好 |
| 對刻意的設計決策提出異議 | 「此函式過長，建議拆分」但拆分會降低可讀性 | 不理解設計意圖 |

---

## 處理完成的驗證

所有 thread 處理完畢後，確認：

1. 每個 thread 都已透過 `resolveReviewThread` 解決
2. 需要修復的項目都已 commit 並 push
3. 需要追蹤的項目都已建立 TODO 或 Issue
4. 不採納的項目都已回覆說明原因
